if(!window.fni){var fni={}}if(!fni.locale){fni.locale={}}if(!fni.locale.dateformat){fni.locale.dateformat={}}fni.locale.dateformat.FNITokenFormatter=Class.create({initialize:function(){},getToken:function(){},format:function(a){}});fni.locale.dateformat.FNITokenFormatterVault={register:function(a){this._formatters.set(a.getToken(),a)},getFormatters:function(){return this._formatters},_formatters:new Hash()};fni.locale.dateformat.FNIPaddedSecondTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{getToken:function(){return"ss"},format:function(a){return a.getSeconds().toPaddedString(2)}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIPaddedSecondTokenFormatter());fni.locale.dateformat.FNIMonthTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{getToken:function(){return"M"},format:function(a){return a.getMonth()+1}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIMonthTokenFormatter());fni.locale.dateformat.FNIMinuteTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{getToken:function(){return"m"},format:function(a){return a.getMinutes()}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIMinuteTokenFormatter());fni.locale.dateformat.FNIPaddedMinuteTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{getToken:function(){return"mm"},format:function(a){return a.getMinutes().toPaddedString(2)}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIPaddedMinuteTokenFormatter());fni.locale.dateformat.FNIPaddedHour24TokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{initialize:function($super){$super()},getToken:function(){return"kk"},format:function(a){return a.getHours().toPaddedString(2)}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIPaddedHour24TokenFormatter());fni.locale.dateformat.FNIPaddedMonthTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{getToken:function(){return"MM"},format:function(a){return(a.getMonth()+1).toPaddedString(2)}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIPaddedMonthTokenFormatter());fni.locale.dateformat.FNIHour12TokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{initialize:function($super){$super()},getToken:function(){return"h"},format:function(a){return((a.getHours()+11)%12)+1}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIHour12TokenFormatter());fni.locale.dateformat.FNIShortYearTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{getToken:function(){return"yy"},format:function(a){return new String(a.getFullYear()).substring(2)}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIShortYearTokenFormatter());fni.locale.dateformat.FNIPaddedMillisecondTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{getToken:function(){return"SSS"},format:function(a){return a.getMilliseconds().toPaddedString(3)}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIPaddedMillisecondTokenFormatter());fni.locale.dateformat.FNIAmPmTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{initialize:function($super){$super()},getToken:function(){return"a"},format:function(a){return(a.getHours()-12)>-1?"p.m.":"a.m."}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIAmPmTokenFormatter());fni.locale.dateformat.FNIDateTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{initialize:function($super){$super()},getToken:function(){return"d"},format:function(a){return a.getDate()}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIDateTokenFormatter());fni.locale.dateformat.FNISecondTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{getToken:function(){return"s"},format:function(a){return a.getSeconds()}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNISecondTokenFormatter());fni.locale.dateformat.FNILocalizedLongDayTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{initialize:function($super){$super()},getToken:function(){return"EE"},format:function(a){return"__EL"+a.getDay().toPaddedString(2)}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNILocalizedLongDayTokenFormatter());fni.locale.dateformat.FNIHour24TokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{getToken:function(){return"k"},format:function(a){return a.getHours()}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIHour24TokenFormatter());fni.locale.dateformat.FNILongYearTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{initialize:function($super){$super()},getToken:function(){return"yyyy"},format:function(a){return a.getFullYear()}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNILongYearTokenFormatter());fni.locale.dateformat.FNIMillisecondTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{initialize:function($super){$super()},getToken:function(){return"S"},format:function(a){return a.getMilliseconds()}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIMillisecondTokenFormatter());fni.locale.dateformat.FNIPaddedHour12TokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{getToken:function(){return"hh"},format:function(a){return(((a.getHours()+11)%12)+1).toPaddedString(2)}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIPaddedHour12TokenFormatter());fni.locale.dateformat.FNILocalizedMonthTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{initialize:function($super){$super()},getToken:function(){return"MMMM"},format:function(a){return"__MM"+(a.getMonth()+1).toPaddedString(2)}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNILocalizedMonthTokenFormatter());fni.locale.dateformat.FNIPaddedDateTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{getToken:function(){return"dd"},format:function(a){return a.getDate().toPaddedString(2)}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNIPaddedDateTokenFormatter());fni.locale.dateformat.FNILocalizedShortDayTokenFormatter=Class.create(fni.locale.dateformat.FNITokenFormatter,{initialize:function($super){$super()},getToken:function(){return"E"},format:function(a){return"__EE"+a.getDay().toPaddedString(2)}});fni.locale.dateformat.FNITokenFormatterVault.register(new fni.locale.dateformat.FNILocalizedShortDayTokenFormatter());fni.locale.dateformat.FNIDateFormat=Class.create({initialize:function(f){this._pattern=f;this._tokenFormatters=new Array();this._localizedMonth=false;this._localizedDayShort=false;this._localizedDayLong=false;var g=f;var c=fni.locale.dateformat.FNITokenFormatterVault.getFormatters();var k=c.keys().sortBy(function(i){return -i.length});var h=0;while(h<f.length){var a=false;if(f[h]=='"'){h++;while(f[h]!='"'){this._tokenFormatters.push(f[h]);h++}h++}for(var d=0,e=k.length;d<e;d++){var j=c.get(k[d]);var b=j.getToken();if(g.indexOf(b)==h){this._tokenFormatters.push(j);h+=b.length;a=true;switch(b){case"E":this._localizedDayShort=true;break;case"EE":this._localizedDayLong=true;break;case"MMMM":this._localizedMonth=true;break}break}}if(!a){this._tokenFormatters.push(f[h]);h+=1}}},format:function(c,d){var b="";for(var f=0,a=this._tokenFormatters.length;f<a;f++){var e=this._tokenFormatters[f];if(Object.isString(e)){b+=e}else{b+=e.format(d)}}if(this._localizedDayLong){var f=b.length;while((f=b.lastIndexOf("__EL",f-1))>=0){var g=b.substring(f+4,f+6);b=b.substring(0,f)+c.getText("weekdayLong_"+g)+b.substring(f+6)}}if(this._localizedDayShort){var f=b.length;while((f=b.lastIndexOf("__EE",f-1))>=0){var g=b.substring(f+4,f+6);b=b.substring(0,f)+c.getText("weekdayShort_"+g)+b.substring(f+6)}}if(this._localizedMonth){var f=b.length;while((f=b.lastIndexOf("__MM",f-1))>=0){var g=b.substring(f+4,f+6);b=b.substring(0,f)+c.getText("month_"+g)+b.substring(f+6)}}return b},getPattern:function(){return this._pattern}});fni.locale.FNILocale=Class.create({initialize:function(){this._locales=new Object();this._settings=new Object();this._loadedLocales=new Hash();this._defaultLocale="en_US"},getDate:function(b,a){var c=new Date(b);return this.getDateFormat(a).format(this,c)},getTime:function(a){var b=new Date(a);return this.getTimeFormat().format(this,b)},getDateTime:function(b,a){return this.getDate(b,a)+" "+this.getTime(b)},getText:function(){var d=new Array();d.push(this.getLocale());var b=$A(arguments);for(var c=0,a=b.length;c<a;c++){d.push(b[c])}return this.getLocalizedText.apply(this,d)},getLocalizedText:function(){var c=$A(arguments);var b=c[0];var e=c[1];var a=this._getLocaleVault(b);if(a){var f=a[e];if(f==undefined){f="[["+e+"]]"}else{for(var d=2;d<c.length;d++){f=f.replace("{"+(d-2)+"}",arguments[d])}}return f}else{return"[["+e+"]]"}},setLanguage:function(a){this._dateFormatShort=undefined;this._dateFormatLong=undefined;this._timeFormat=undefined;this._currentLanguage=a},setCountry:function(a){this._dateFormatShort=undefined;this._dateFormatLong=undefined;this._timeFormat=undefined;this._currentCountry=a},getCountry:function(){return this._currentCountry},setLocale:function(a){var b=a.split("_");if(b.length==2){this.setLanguage(b[0]);this.setCountry(b[1])}else{this.setLanguage(b[0]);this.setCountry(null)}},getLanguage:function(){return this._currentLanguage},getLocale:function(){return this.getLanguage()+"_"+this.getCountry()},getDateFormat:function(a){if(a==true){if(!this._dateFormatLong){var b=this.getSetting("dateFormatLong");if(!b||b.blank()||(b=="[[dateFormatLong]]")){b="dd.MMMM.yyyy"}this._dateFormatLong=new fni.locale.dateformat.FNIDateFormat(b)}return this._dateFormatLong}else{if(!this._dateFormatShort){var b=this.getSetting("dateFormatShort");if(!b||b.blank()||(b=="[[dateFormatShort]]")){b="dd.MM.yyyy"}this._dateFormatShort=new fni.locale.dateformat.FNIDateFormat(b)}return this._dateFormatShort}},getTimeFormat:function(){if(!this._timeFormat){var a=this.getSetting("timeFormat");if(!a||a.blank()||(a=="[[timeFormat]]")){a="kk:mm"}this._timeFormat=new fni.locale.dateformat.FNIDateFormat(a)}return this._timeFormat},getLocales:function(){return this._loadedLocales.keys()},getLanguages:function(){var b=new Array();var a=this.getLocales();for(var d=0,c=a.length;d<c;d++){b.push(a[d].split("_")[0])}return b},getSetting:function(a){var b=this._getSettingVault(this.getLocale());if(b){return b[a]}else{return"[["+a+"]]"}},setSetting:function(a,c){var b=this._getSettingVault(this.getLocale());if(b){b[a]=c}},loadLocale:function(a,b){var c=this;new Ajax.Request(b,{onSuccess:function(h){try{var f=h.responseText.evalJSON();for(var d in f.localeStrings){c._setLocaleString(a,d,f.localeStrings[d])}for(var d in f.settings){c._setLocaleSetting(a,d,f.settings[d])}c._loadedLocales.set(a,true)}catch(g){alert("Locale "+b+" loading failed:"+g)}},asynchronous:false})},_getLocaleVault:function(b){var a=this._locales[b];if(!a){var c=b.split("_");if(c.length==2){a=this._locales[c[0]]}}if(!a){a=this._locales[this._defaultLocale]}return a},_getSettingVault:function(a){var c=this._settings[a];if(!c){var b=a.split("_");if(b.length==2){c=this._settings[b[0]]}}if(!c){c=this._settings[this._defaultLocale]}return c},_setLocaleString:function(a,c,b){if(!this._locales[a]){this._locales[a]=new Object()}var d=a.split("_");if(d.length==2){var e=d[0];if(!this._locales[e]){this._locales[e]=new Object()}this._locales[a][c]=b;this._locales[e][c]=b}else{this._locales[a][c]=b}},_setLocaleSetting:function(a,b,d){if(!this._settings[a]){this._settings[a]=new Object()}var c=a.split("_");if(c.lenght==2){if(!this._settings[lang]){this._settings[lang]=new Object()}this._settings[a][b]=d;this._settings[lang][b]=d}else{this._settings[a][b]=d}}});Object.extend(fni.locale.FNILocale.prototype,fni.events.FNIEventSupport);